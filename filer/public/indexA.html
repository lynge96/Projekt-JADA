<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <script src="scripts/d3.js"></script>
    <link rel="stylesheet" href="styles.css" />

    <title>Projekt: JADA</title>

    <style type="text/css"></style>
  </head>

  <body>
    <h1>Data is beautiful, soonish...</h1>
    <br />
    <script>
      // Denne query kører op imod API'en som findes i 'main.js'.
      // Denne HTML skal derfor åbnes igennem serveren for at virke.
      d3.json("/api/co2country", {
        method: "POST",
      }).then(function (response) {
        const dataCO2lande = response.data; // Hent data ud af response
        console.log("Lande CO2", dataCO2lande);

        d3.json("/api/co2capita", {
          method: "POST",
        }).then(function (response) {
          const dataCO2capita = response.data; // Hent data ud af response
          console.log("Capita CO2", dataCO2capita);
          ///////////////////////////////////////////////////////////////

          // SVG elementet defineres:
          const w = 800;
          const h = 600;
          const padding = 69;
          // SVG elementet laves:
          const svg = d3.select("body")
            .append("svg")
            .attr("width", w)
            .attr("height", h);
          
          // Laver en scale for X-aksen
          let xScale = d3.scaleLinear()
            .range([padding, w - padding])
            .domain([d3.min(dataCO2lande, function (d) { return d.year}), d3.max(dataCO2lande, function (d) { return d.year; })]);
          // Definerer X-aksen
          let xAxis = d3.axisBottom()
            .scale(xScale)
            .tickFormat(function (d) { return parseInt(d, 10) })
            .ticks(7)
            .tickPadding(10);
          // Appender X-aksen til SVG'en
          svg.append("g")
            .attr("class", "x-axis")
            .attr("transform", "translate(0, " + (h - padding) + ")")
            .transition()
            .duration(1000)
            .call(xAxis);
          
          // Laver en scale for Y-aksen
          let yScale = d3.scaleLinear()
            .range([h - padding, padding])
            .domain([0, d3.max(dataCO2lande, function (d) {return parseFloat(d.co2); })])
          // Definerer Y-aksen
          let yAxis = d3.axisLeft()
            .scale(yScale)
            .ticks(5)
            .tickPadding(10);
          // Appender Y-aksen til SVG'en
          svg.append("g")
            .attr("class", "y-axis")
            .attr("transform", "translate(" + (padding) + ", 0)")
            .transition()
            .duration(1000)
            .call(yAxis);

          // Genererer et Map til Lande
          const landeMap = d3.group(dataCO2lande, function(d) { return d.lokation});
          console.log(landeMap.get('Denmark'));

          // Laver konstant til linegraph
          const lineGenerator = d3.line()
            .x(function(d) { return xScale(d.year); })
            .y(function(d) { return yScale(parseFloat(d.co2)); });
          
          // Laver line
          svg.append("path")
            .data(landeMap)
            .attr("class", "line")
            .attr("d", lineGenerator(dataCO2lande));
          


          // virker denne branch?



            
        });
      });
    </script>
  </body>
</html>
