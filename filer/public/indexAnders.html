<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <script src="scripts/d3.js"></script>
    <title>Project: JADA</title>

    <style type="text/css">
      svg {
        background-color: rgb(55, 55, 55);
      }
      body {
        background-color: rgb(39, 39, 39);
      }
      .axis {
        stroke-width: 2px;
        color: rgb(122, 122, 122);
        font-size: 15px;
      }
    </style>
  </head>

  <body>
    <h1>Data is beautiful, soon... ish</h1>

    <!-- Laver knapper til datasortering -->
    <button id="klik1">Pr. Land</button>
    <button id="klik2">Pr. Capita</button>

    <br />
    <script>
      // Denne query kører op imod API'en som findes i 'main.js'.
      // Denne HTML skal derfor åbnes igennem serveren for at virke.
      d3.json("/api/co2country", {
        method: "POST",
      }).then(function (response) {
        const dataCO2 = response.data; // Hent data ud af response
        console.log("Alt data", dataCO2);
        console.log("første række:", dataCO2[0]);

        // Definerer SVG størrelse og padding
        const w = 750;
        const h = 600;
        const padding = 69;
        // SVG element
        const svg = d3.select("body")
          .append("svg")
          .attr("width", w)
          .attr("height", h);

        // Definerer domain ranges for år, co2country og co2capita.
        // År domain
        let minÅr = d3.min(dataCO2, function(d) {
          return d.year;
        })
        let maxÅr = d3.max(dataCO2, function(d) {
          return d.year;
        })
        console.log(`Det første år i datasættet er ${minÅr} og det sidste er ${maxÅr}!`);
        // CO2 pr. land domain
        let minCO2country = d3.min(dataCO2, function(d) {
          return parseInt(d.co2country);
        })
        let maxCO2country = d3.max(dataCO2, function(d) {
          return parseInt(d.co2country);
        })
        console.log(`Den laveste CO2 udledning er ${minCO2country} og den højeste er ${maxCO2country}!`);
        // CO2 pr. capita domain
        let minCO2capita = d3.min(dataCO2, function(d) {
          return parseFloat(d.co2capita);
        })
        let maxCO2capita = d3.max(dataCO2, function(d) {
          return parseFloat(d.co2capita);
        })
        console.log(`Laveste CO2 pr. capita er ${minCO2capita} og den største er ${maxCO2capita}!`);
        // Scales for akserne.
        // X-akse - Scale
        const xScale = d3.scaleLinear()
          .domain([minÅr, maxÅr])
          .range([padding, w - padding]);
        // X-akse - Attributter
        const xAxis = d3.axisBottom()
          .scale(xScale)
          .ticks(7)
          .tickFormat(function (d) {
            return parseInt(d, 10)
          });
        // X-akse - SVG
        svg.append("g")
          .attr("class", "axis")
          .attr("transform", "translate(0, " + (h - padding) + ")")
          .call(xAxis);
        // Y-akse - ScaleLande
        const yScaleLand = d3.scaleLinear()
          .domain([minCO2country, maxCO2country])
          .range([h - padding, padding]);
        // Y-akse - ScaleCapita
        const yScaleCapita = d3.scaleLinear()
          .domain([minCO2capita, maxCO2capita])
          .range([h - padding, padding]);

        // Tilfældig farve
        let farvearray = [];
        for (i = 0; i <= dataCO2.length; i++) {
          farvearray.push(Math.floor(Math.random() * 16777215).toString(16))
        }

        const landeOpdelt = d3.group(dataCO2, d => d.lokation);
        console.log(landeOpdelt);

        // Line Graf - Lande
        // svg
        //   .selectAll(".line")
        //   .data(landeOpdelt)
        //   .attr("class", "line")
        //   .join("path")
        //   .attr("fill", "none")
        //   .attr("stroke", function (d, i) {
        //     return ("#" + farvearray[i]) })
        //   .attr("stroke-width", 1.5)
        //   .attr("d", function (d) {
        //     return d3.line()
        //     .x(function(d) { return xScale(d.year) })
        //     .y(function(d) { return yScaleLand(d.co2country) })
        //     (d[1])
        //   })
        // Line Graf - Capita        
        svg
          .selectAll(".line")
          .data(landeOpdelt)
          .enter()
          .append("path")
            .attr("fill", "none")
            .attr("stroke", function (d, i) {
             return ("#" + farvearray[i]) })
            .attr("stroke-width", 1.5)
            .attr("d", function (d) {
             return d3.line()
              .x(function(d) { return xScale(d.year) })
              .y(function(d) { return yScaleCapita(+d.co2capita) })
              (d[1])
          })        

      });
    </script>
  </body>
</html>
